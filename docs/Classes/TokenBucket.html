<!DOCTYPE html>
<html lang="en">
  <head>
    <title>TokenBucket Class Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset="utf-8">
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
    <script src="../js/lunr.min.js" defer></script>
    <script src="../js/typeahead.jquery.js" defer></script>
    <script src="../js/jazzy.search.js" defer></script>
  </head>
  <body>

    <a name="//apple_ref/swift/Class/TokenBucket" class="dashAnchor"></a>

    <a title="TokenBucket Class Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="../index.html">
           Docs
        </a>
         (28% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="../search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="../index.html"> Reference</a>
      <img class="carat" src="../img/carat.png" />
      TokenBucket Class Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../readme.html">README</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/AnalyticsService.html">AnalyticsService</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/AnalyticsService/VaporEnvironment.html">– VaporEnvironment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/CoreDataManager.html">CoreDataManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/LocalAppSession.html">LocalAppSession</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/LocalEvent.html">LocalEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/TokenBucket.html">TokenBucket</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/VaporNetworkService.html">VaporNetworkService</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/AnalyticEventType.html">AnalyticEventType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/AnalyticEventTypeProtocol.html">AnalyticEventTypeProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/VaporModel.html">VaporModel</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AnalyticsConfiguration.html">AnalyticsConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AnalyticsConfiguration/Environment.html">– Environment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AppInfoModel.html">AppInfoModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DayMeasurements.html">DayMeasurements</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevEventsView.html">DevEventsView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevEventsView_Previews.html">DevEventsView_Previews</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevLocalEventDetailView.html">DevLocalEventDetailView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevLocalSessionDetailView.html">DevLocalSessionDetailView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevNetworkEventsView.html">DevNetworkEventsView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevNetworkEventsView_Previews.html">DevNetworkEventsView_Previews</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevSessionsView.html">DevSessionsView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DevSessionsView_Previews.html">DevSessionsView_Previews</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/GlobalDeviceInfoModel.html">GlobalDeviceInfoModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/LocalDeviceInfoModel.html">LocalDeviceInfoModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/Location.html">Location</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/Location/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAnalyticEventModel.html">VaporAnalyticEventModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAnalyticEventModel/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAnalyticSessionModel.html">VaporAnalyticSessionModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAnalyticSessionModel/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAppInfoModel.html">VaporAppInfoModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporAppInfoModel/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporDeviceModel.html">VaporDeviceModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporDeviceModel/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporUserModel.html">VaporUserModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/VaporUserModel/CodingKeys.html">– CodingKeys</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/WeatherInfo.html">WeatherInfo</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:12AppAnalytics18TemperatureCelsiusa">TemperatureCelsius</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:12AppAnalytics21TemperatureFahrenheita">TemperatureFahrenheit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:12AppAnalytics7VaporIDa">VaporID</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            <h1>TokenBucket</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight swift"><code><span class="kd">internal</span> <span class="kd">class</span> <span class="kt">TokenBucket</span></code></pre>

                </div>
              </div>
            <p>Token Bucket</p>

<p>A Token bucket is a simple algorithm used for rate-limiting events and shaping network traffic</p>

<p>Notes:
The benefit of using a TokenBucket is that it does not require any system level timers to manage the dispatching of events to the network. When the system wants to send an event it first checks the token bucket to see if it has enough tokens to to do this. If not then then the event must wait for the buck to be refreshed the token refresh is determined by the <code>tokensPerInterval</code> and the <code>interval</code>. the tokenBucket is checked for potential refresh every time the system requests a <code>tokenCount</code>.</p>

<p>For the Analytics usage the <code>tokenCount</code> is checked everytime an event is posted to the local storage via the <code>dispatchAnalyticEvent</code> call. Every <code>dispatchAnalyticEvent</code> will trigger a <code>flush</code> request that will request events oldest first and dispatch them to the network as the accumulated tokens permit, in this way events are dispatched FIFO style and will not overwhelm the network with a large body of network requests.</p>

<p>References:</p>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Token_bucket">https://en.wikipedia.org/wiki/Token_bucket</a></li>
<li><a href="https://pfandrade.me/blog/rate-limiting-using-a-token-bucket-in-swift/">https://pfandrade.me/blog/rate-limiting-using-a-token-bucket-in-swift/</a></li>
<li><a href="https://github.com/pfandrade/TokenBucket">https://github.com/pfandrade/TokenBucket</a></li>
<li><p><a href="https://github.com/nuclearace/SwiftRateLimiter">https://github.com/nuclearace/SwiftRateLimiter</a></p></li>
<li><p><a href="https://www.juniper.net/documentation/en_US/junos/topics/concept/policer-algorithm-single-token-bucket.html">https://www.juniper.net/documentation/en_US/junos/topics/concept/policer-algorithm-single-token-bucket.html</a></p></li>
<li><p><a href="https://dzone.com/articles/detailed-explanation-of-guava-ratelimiters-throttl">https://dzone.com/articles/detailed-explanation-of-guava-ratelimiters-throttl</a></p></li>
</ul>

          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC8capacitySivp"></a>
                    <a name="//apple_ref/swift/Property/capacity" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC8capacitySivp">capacity</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>capacity</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="k">let</span> <span class="nv">capacity</span><span class="p">:</span> <span class="kt">Int</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC20replenishingIntervalSdvp"></a>
                    <a name="//apple_ref/swift/Property/replenishingInterval" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC20replenishingIntervalSdvp">replenishingInterval</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>private replenish interval in seconds</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">replenishingInterval</span><span class="p">:</span> <span class="kt">TimeInterval</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC17tokensPerIntervalSivp"></a>
                    <a name="//apple_ref/swift/Property/tokensPerInterval" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC17tokensPerIntervalSivp">tokensPerInterval</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>private tokens per interval</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">tokensPerInterval</span><span class="p">:</span> <span class="kt">Int</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC10tokenCountSivp"></a>
                    <a name="//apple_ref/swift/Property/tokenCount" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC10tokenCountSivp">tokenCount</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>current token count</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="k">var</span> <span class="nv">tokenCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC8capacity17tokensPerInterval8interval07initialC5CountACSi_SiSdSitcfc"></a>
                    <a name="//apple_ref/swift/Method/init(capacity:tokensPerInterval:interval:initialTokenCount:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC8capacity17tokensPerInterval8interval07initialC5CountACSi_SiSdSitcfc">init(capacity:tokensPerInterval:interval:initialTokenCount:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>TokenBucket initializer</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">capacity</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">tokensPerInterval</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">interval</span><span class="p">:</span> <span class="kt">TimeInterval</span><span class="p">,</span> <span class="nv">initialTokenCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>capacity</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>number of tokens in the bucket</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>tokensPerInterval</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>tokens refreshed per interval</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>interval</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>interval in seconds the tokens will be replenished.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>initialTokenCount</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>inital token couunt</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC7consumeyySiF"></a>
                    <a name="//apple_ref/swift/Method/consume(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC7consumeyySiF">consume(_:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>consumer</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">consume</span><span class="p">(</span><span class="n">_</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:12AppAnalytics11TokenBucketC10tryConsume_5untilSbSi_10Foundation4DateVtF"></a>
                    <a name="//apple_ref/swift/Method/tryConsume(_:until:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:12AppAnalytics11TokenBucketC10tryConsume_5untilSbSi_10Foundation4DateVtF">tryConsume(_:until:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>try and consume</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">tryConsume</span><span class="p">(</span><span class="n">_</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">until</span> <span class="nv">limitDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2019-12-12)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
